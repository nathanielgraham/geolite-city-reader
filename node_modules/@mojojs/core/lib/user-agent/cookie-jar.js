import { format } from 'url';
import tough from 'tough-cookie';
/**
 * Cookie jar class.
 */
export class CookieJar {
    constructor() {
        /**
         * Cookie storage.
         */
        this.storage = new tough.CookieJar();
    }
    /**
     * Load cookies from storage.
     */
    async loadCookies(url) {
        const cookies = await this.storage.getCookies(this._cookieURL(url));
        if (cookies.length > 0)
            return cookies.map(cookie => cookie.cookieString()).join('; ');
        return null;
    }
    /**
     * Store cookies.
     */
    async storeCookies(url, header) {
        if (header === undefined)
            return;
        const cookieURL = this._cookieURL(url);
        for (const cookie of header.map(value => tough.Cookie.parse(value ?? ''))) {
            if (cookie === undefined)
                continue;
            await this.storage.setCookie(cookie, cookieURL);
        }
    }
    _cookieURL(currentURL) {
        return format(currentURL, { auth: false, fragment: false, search: false });
    }
}
//# sourceMappingURL=cookie-jar.js.map